# ふらんBot - ゆきののつぶやきbot

ふらんちゃんだよよろしくぅ～

## Self Introduction (English)

It's Flandre, nice to meet you~

## 📁 ファイル構成

```folder
flandre_bot_refactored/
├── main.py                 # 起動用ファイル（ここを実行する）
├── bot.py                  # Bot本体のクラス
├── config.py               # 設定ファイル（環境変数の読み込み）
├── commands/               # コマンド群
│   ├── __init__.py
│   ├── help.py            # ヘルプ・動作確認コマンド
│   ├── admin.py           # 管理系コマンド
│   ├── images.py          # 画像表示コマンド
│   ├── fun.py             # 遊び系コマンド
│   └── voice.py           # VC関連コマンド
├── services/               # サービス層（ビジネスロジック）
│   ├── __init__.py
│   ├── permission.py      # 権限チェック
│   └── storage.py         # JSONファイル操作
└── README.md              # このファイル
```

## 🚀 起動方法

```bash
# 1. 必要なパッケージをインストール
pip install discord.py python-dotenv

# 2. .envファイルを作成して、Discord tokenを設定
# DISCORD_TOKEN=あなたのトークン
# DEVELOPER_ID=あなたのユーザーID

# 3. botを起動
python main.py
```

## 🎯 構造化のポイント

### 1. ファイル分割

元のコードは1ファイル500行でしたが、機能ごとに分割しました：

- **commands/** : コマンドの実装
- **services/** : 共通処理（権限チェック、ファイル操作）
- **config.py** : 設定の一元管理

### 2. クラス化

`FlandreBot`クラスで、Bot全体をカプセル化しました：

```python
flandre = FlandreBot(TOKEN)
flandre.run()
```

### 3. 責任の分離

- **commands/** : ユーザーとのやり取り（Discord API）
- **services/** : ビジネスロジック（権限チェック、データ保存）
- **config.py** : 設定値の管理

### 4. 読みやすさ

- 各ファイルは100〜200行程度
- 機能ごとにファイルが分かれている
- 関数・クラスの役割が明確

## 📝 今後の改善案

1. **データベース化**: JSONファイル → SQLite
2. **エラーログ**: printではなくloggingモジュール
3. **テストコード**: pytestでユニットテスト
4. **型チェック**: mypyで型安全性を確保

## 🆚 元のコードとの比較

| 項目 | 元のコード | リファクタリング版 |
| ---- | --------- | ----------------- |
| ファイル数 | 1ファイル | 10ファイル |
| 行数/ファイル | 500行 | 50〜200行 |
| グローバル変数 | 多数 | 最小限 |
| 構造 | フラット | 階層化 |
| 保守性 | 低い | 高い |

## 🤔 なぜ構造化するのか？

- **見つけやすい**: 「画像コマンド直したい」→ `commands/images.py`を開く
- **影響範囲が明確**: 権限チェック変更 → `services/permission.py`だけ
- **テストしやすい**: 各関数が独立しているのでテスト可能
- **チーム開発できる**: 担当を分けられる
- **拡張しやすい**: 新機能は新しいファイルに追加

## 📖 参考

このリファクタリングは、以下の原則に基づいています：

- **単一責任の原則**: 1つのモジュールは1つの責任だけを持つ
- **関心の分離**: UIロジックとビジネスロジックを分ける
- **DRY原則**: 同じコードを繰り返し書かない（共通処理はservices/へ）
